---
title: "Rで「Python実践データ分析100本ノック」"
subtitle: "第1章 ウェブからの注文数を分析する10本ノック"
date: "`r format(Sys.time(),'%Y-%m-%d')`"
author:
- "タナカケンタ"
- "(tanaka@mana.bi)"
output:
  html_notebook:
    toc: true
    theme: spacelab
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(cache = TRUE)
options(dplyr.width = Inf)
```

# はじめに

このNotebookは、[Python実践データ分析100本ノック](https://amzn.to/31gVxwz)のコードを、R言語で実装しようというものです。各章のNotebookについては、[筆者のWebサイト](https://mana.bi/wiki.cgi?page=R%A4%C7%A1%D6Python%BC%C2%C1%A9%A5%C7%A1%BC%A5%BF%CA%AC%C0%CF100%CB%DC%A5%CE%A5%C3%A5%AF%A1%D7)からアクセスしてください。

<div align="center">
<a href="https://www.amazon.co.jp/dp/4798058750/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=dsciesotist-22&linkId=a7cfc337c3cb35cc0af817ffd6260423&language=ja_JP" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4798058750&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=dsciesotist-22&language=ja_JP" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=dsciesotist-22&language=ja_JP&l=li3&o=9&a=4798058750" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br />
[Python実践データ分析100本ノック](https://amzn.to/31gVxwz)
</div>

書籍自体は、「実践」と言ってもさほど難易度は高くなく、「Pythonの参考書を１冊読んだり、入門研修を受けてみて、何となくPandas、Matplotlib、Scikit-Learnが使えるようになった」人が、知識を定着させるために、ビジネスにおいてありがちなデータでコーディングを学ぶために、ちょうどよい本だと思います。

このNotebookでは、書籍の内容や[公開されているデータ](https://www.shuwasystem.co.jp/support/7980html/5875.html)をもとに、「ノック」の内容をR言語で実装することを試みます。なお、できるだけモダンなRコードを意図し、[tidyverse](https://www.tidyverse.org/)の各パッケージを使用します。なお、記事の筆者の環境は、Windows 10のWSL (Ubuntu 18.04) 上にRStudio Serverをインストールしています (つまり、UTF-8が標準の環境です)。

第1章では、ECサイトのデータを扱っています。以下の6個のデータを組み合わせて使います。なお、データはダウンロードしたのち、`data/chapXX` ディレクトリに再配置しています。

* customer_master.csv
* item_master.csv
* transaction_1.csv
* transaction_2.csv
* transaction_detail_1.csv
* transaction_detail_2.csv

# 共通: パッケージの読み込み

データ加工、可視化のためのtidyverseパッケージ群を読み込みます。

```{r eval=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
```

# ノック1: データを読み込んでみよう

はじめに、customer_master.csvを読み込み、最初の5行を表示します。Rでは、`head()` 関数の出力がデフォルトで6行なので、`n = 5` と行数を明示しています。

```{r eval=TRUE, message=FALSE, warning=FALSE}
customer_master <- read_csv("data/chap01/customer_master.csv")
head(customer_master, n = 5)
```

他のデータも読み込みます。

```{r eval=TRUE, message=FALSE, warning=FALSE}
item_master <- read_csv("data/chap01/item_master.csv")
head(item_master, n = 5)
```

```{r eval=TRUE, message=FALSE, warning=FALSE}
transaction_1 <- read_csv("data/chap01/transaction_1.csv")
head(transaction_1, n = 5)
```

```{r eval=TRUE, message=FALSE, warning=FALSE}
transaction_detail_1 <- read_csv("data/chap01/transaction_detail_1.csv")
head(transaction_detail_1, n = 5)
```

# ノック2: データを結合 (ユニオン) してみよう

transaction_1とtransaction_2、transaction_detail_1とtransaction_detail_2をそれぞれ行方向に結合 (ユニオン) します。前節でtransaction_1、transaction_detail_1は読み込んでいるので、transaction_2、transaction_detail_2を読み込み、結合した結果をtransactionおよびtransaction_detailという名前で保存します。

## transactionデータの結合

```{r eval=TRUE, message=FALSE, warning=FALSE}
transaction_2 <- read_csv("data/chap01/transaction_2.csv")

transaction <- bind_rows(transaction_1, transaction_2)

head(transaction, n = 5)
```

結合できたことを確認するために、行数を出力します。

```{r eval=TRUE, message=FALSE, warning=FALSE}
nrow(transaction_1)
nrow(transaction_2)
nrow(transaction)
```

## transaction_detailデータの結合

```{r eval=TRUE, message=FALSE, warning=FALSE}
transaction_detail_2 <- read_csv("data/chap01/transaction_detail_2.csv")

transaction_detail <- bind_rows(transaction_detail_1, transaction_detail_2)

head(transaction_detail, n = 5)
```

結合できたことを確認するために、行数を出力します。

```{r eval=TRUE, message=FALSE, warning=FALSE}
nrow(transaction_detail_1)
nrow(transaction_detail_2)
nrow(transaction_detail)
```

# ノック3: 売上データ同士を結合 (ジョイン) してみよう

transaction_detailデータに、transactionデータの `payment_date` と `customer_id` をジョインします。結合キーは、`transaction_id` です。

```{r eval=TRUE, message=FALSE, warning=FALSE}
join_data <- left_join(transaction_detail, select(transaction, transaction_id, payment_date, customer_id), by = "transaction_id")
head(join_data, n = 5)
```

# ノック4: マスターデータを結合 (ジョイン) してみよう

前節で作成したjoin_dataに、さらにcustomer_masterとitem_masterを結合します。結合キーは、それぞれ `customer_id` と `item_id` です。

```{r eval=TRUE, message=FALSE, warning=FALSE}
join_data <- left_join(join_data, customer_master, by = "customer_id")
join_data <- left_join(join_data, item_master, by = "item_id")
head(join_data, n = 5)
```
